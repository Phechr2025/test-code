
{% extends "layout.html" %}
{% block content %}
<section class="card">
  <h2>แผงควบคุม</h2>
  <form method="post" action="{{ url_for('admin_toggle') }}" onsubmit="return confirm('ยืนยันเปลี่ยนสถานะดาวน์โหลด?')">
    <div class="formrow">
      <label>สถานะดาวน์โหลด:</label>
      <select name="enable">
        <option value="1" {% if enabled %}selected{% endif %}>เปิด</option>
        <option value="0" {% if not enabled %}selected{% endif %}>ปิด</option>
      </select>
    </div>
    <button class="btn success">บันทึก</button>
    <a class="btn danger" href="{{ url_for('admin_logout') }}">ออกจากระบบ</a>
    <button formaction="{{ url_for('admin_restart') }}" formmethod="post" class="btn" onclick="return confirm('ยืนยันรีสตาร์ท?')">รีสตาร์ทเว็บ (จำลอง)</button>
  </form>

</section>

<section class="card">
  <h3>แพลตฟอร์มที่เปิดให้ใช้งาน</h3>
  <form method="post" action="{{ url_for('admin_platforms') }}">
    <div class="formrow">
      <label>เลือกแพลตฟอร์มที่ให้ผู้ใช้ใช้งานได้:</label>
      <div class="checkbox-group">
        <label><input type="checkbox" name="platforms" value="youtube" {% if platforms.youtube %}checked{% endif %}> YouTube</label>
        <label><input type="checkbox" name="platforms" value="tiktok" {% if platforms.tiktok %}checked{% endif %}> TikTok</label>
        <label><input type="checkbox" name="platforms" value="bilibili" {% if platforms.bilibili %}checked{% endif %}> Bilibili</label>
        <label><input type="checkbox" name="platforms" value="instagram" {% if platforms.instagram %}checked{% endif %}> Instagram</label>
        <label><input type="checkbox" name="platforms" value="facebook" {% if platforms.facebook %}checked{% endif %}> Facebook</label>
      </div>
    </div>
    <button class="btn success">บันทึกแพลตฟอร์ม</button>
  </form>
</section>


<section class="card">
  <h3>ประวัติการดาวน์โหลดล่าสุด</h3>
  <div class="table">
    <div class="tr head">
      <div>เวลา (UTC)</div>
      <div>รูปแบบ</div>
      <div>คุณภาพ</div>
      <div>ชื่อที่ตั้งไฟล์</div>
      <div>ลิงก์ (URL)</div>
    </div>
    {% for h in history %}
      <div class="tr">
        <div>{{ h.when }}</div>
        <div>{{ h.format }}</div>
        <div>{{ h.quality or '-' }}</div>
        <div>{{ h.title }}</div>
        <div class="wrap">{{ h.url }}</div>
      </div>
    {% endfor %}
    {% if not history %}
      <div class="tr"><div colspan="5">ยังไม่มีข้อมูล</div></div>
    {% endif %}
  </div>
</section>
{% endblock %}
