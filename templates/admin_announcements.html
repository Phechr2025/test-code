{% extends "base.html" %}
{% block title %}จัดการประกาศ{% endblock %}

{% block content %}
<h1>จัดการประกาศของแอดมิน</h1>

<section class="form-section">
  <h2>เพิ่มประกาศใหม่</h2>
  <form method="post" enctype="multipart/form-data" class="form">
    <label for="title">หัวข้อประกาศ</label>
    <input type="text" id="title" name="title" required placeholder="เช่น ประกาศปิดปรับปรุงระบบ">

    <label for="content">รายละเอียด</label>
    <textarea id="content" name="content" rows="4" placeholder="พิมพ์ข้อความ รายละเอียด ลิงก์ หรือโค้ด HTML ง่าย ๆ ได้ เช่น &lt;a href=&quot;...&quot;&gt;คลิก&lt;/a&gt;"></textarea>

    <label for="image_url">ลิงก์รูปภาพ (ไม่บังคับ)</label>
    <input type="url" id="image_url" name="image_url" placeholder="ใส่ลิงก์จาก Google Drive / เว็บอื่น ๆ ถ้ามี">

    <label for="image_file">อัปโหลดรูปภาพจากเครื่อง (ไม่บังคับ)</label>
    <input type="file" id="image_file" name="image_file" accept="image/*">

    <p class="hint">
      ถ้าใส่ทั้งลิงก์รูปภาพและอัปโหลดรูป ระบบจะใช้ไฟล์ที่อัปโหลดจากเครื่องเป็นหลัก<br>
      ผู้ใช้สามารถคลิกรูปในหน้ารวมประกาศเพื่อเปิดรูปแบบเต็มได้
    </p>

    <button type="submit" class="btn primary">เพิ่มประกาศ</button>
  </form>
</section>

<section class="list-section">
  <h2>รายการประกาศทั้งหมด</h2>
  {% if announcements %}
    <div class="grid">
      {% for ann in announcements %}
        <article class="card">
          {% if ann.image_url %}
            <a href="{{ ann.image_url }}" target="_blank" rel="noopener">
              <img src="{{ ann.image_url }}" alt="{{ ann.title }}" class="thumb">
            </a>
          {% endif %}
          <div class="card-body">
            <h3 class="card-title">{{ ann.title }}</h3>
            <p class="meta">{{ ann.created_at|thdt }}</p>
            <p class="card-text">{{ ann.content|safe }}</p>
            <div class="card-actions">
              <a href="{{ url_for('admin_edit_announcement', ann_id=ann.id) }}" class="btn small">แก้ไข</a>
              <form action="{{ url_for('admin_delete_announcement', ann_id=ann.id) }}" method="post" style="display:inline" onsubmit="return confirm('ยืนยันการลบประกาศนี้หรือไม่?');">
                <button type="submit" class="btn small danger">ลบ</button>
              </form>
            </div>
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <p class="hint">ยังไม่มีประกาศในระบบ</p>
  {% endif %}
</section>
{% endblock %}
